---
title: "03-2. 람다 활용2 : 메소드 참조"
excerpt: "메소드 참조를 이용해서 람다식을 더욱 간략화 하자."
categories:
    - JAVA8
tags:
    - Lambda
last_modified_at: 2021-05-15
---

# 람다 활용 2편
* 람다와 동작 파라미터화로 유연하고 간결한 코드를 구현하는데 도움을 주는 실용적인 예시를 살펴보자.

## 목차
* 형식추론
* 지역 변수 사용
* **메소드 참조**
* 람다 표현식들의 조합

## 형식추론 (Type)
* **람다의 구성요소(파라미터, 바디)나, 그 람다 표현식의 타입을 이용해 함수형 인터페이스를 추론**할 수 있다.
* 람다 표현식의 타입을 `대상 형식(Target Type)`이라고 부름.

![형식추론.png](https://github.com/kujaHn/kujaHn.github.io/blob/master/image/JAVA8/ch3/ch3_5.png)

* 만약 함수형 인터페이스 제네릭에 형식(Type)이 명시되어 있다면, 형식추론을 이용해 더 간략화 할 수 있다.
    ```java
    // 형식 추론 X
    Comparator<Student> c1 = (Student s1, Student s2) -> s1.getGrade().compareTo(s2.getGrade()); 
    // 형식 추론 O
    Comparator<Student> c2 = (s1, s2) -> s1.getGrade().compareTo(s2.getGrade());   
    ```
    * 명시적으로 타입 사용(형식 추론 X)하는게 좋을 수도, 생략하는 것(형식 추론 O)이 좋을 수도 있다.

## 지역 변수 사용
* 지금까지는 모두 람다 내 **파라미터에서만 변수들을 가져왔다.**
* **파라미터 외에 정의된 변수(자유변수)들도 사용할 수 있지 않을까?** 당연히 가능하다.
    * 자유 변수 : 파라미터로 넘겨진 변수가 아닌 외부에서 정의된 변수.
    
### 지역 변수 사용시 주의 사항
* 자유변수(인스턴스 변수, 정적변수)를 사용 시 **명시적으로 final로 선언 되거나, 그렇게 취급이 되어야 한다.**
* 이 이유는 **멀티쓰레드와 관련이 있다.**

#### 지역변수와 멀티 쓰레드
* 변수에 대한 개념은 [여기](!주소넣기)서 확인하자.
* 일단 인스턴스 변수는 힙에 저장되고, 지역 변수는 스택에 위치한다.
* 만약 람다에서 지역변수에 바로 접근이 가능할 때 스레드에서 실행이 되면, 변수를 할당한 스레드가 사라져 변수 할당이 해제되었는데도
  람다를 실행하는 스레드에서는 해당 변수에 접근하려 할 수 있다.
* 그렇게 되면 자유 지역 변수의 복사본을 제공하게 되는데, 복사본의 값이 바뀌어서는 안되기 때문에 final로 할당을 해야 한다.


## 메소드 참조
* **메소드 참조를 사용하면 람다 표현식을 더욱 축약**할 수 있다.
  * 기본 형태는 다음과 같다. `ClassName::method`
    * 예시
    
    |람다|메소드참조|
    |:----:|:----:|
    |`(Student student) -> student.getGender()`|`Student::getGender`|
    |`() -> {Thread.currentThread().dumpStack()}`|`Thread.currentThread()::dumpStack`|
    |`(str, i) -> str.substring(i)`|`String::substring`|
    |`(String s) -> System.out.println(s) (String s)`|`System.out::println`|
    |`-> this.isValidNames(s)`|`this::isValidNames`|

## 생성자 참조
* `ClassName::new`처럼 new 키워드를 이용해서 기존 생성자의 참조를 만들 수 있다.
  ```java
  Supplier<Student> s1 = new Student()
  Supplier<Student> s2 = () -> new Supplier();
  Supplier<Student> s3 = Supplier::new;
  Supplier supply1 = s1.get();
  ```


## 람다 + 메소드 참조
* 이제 배운 모든 것을 활용해서 다음 코드를 간략화 해보자.  
  `student.sort((Student s1, Student s2) -> Integer.compare(s1.getGrade(), s2.getGrade()));`
  
### 1st 코드 전달
* `sort()`는 `Comparator<T>` 파라미터를 받는다.  **동작 파라미터화 되었다**고 볼 수 있다. `void sort(Comparator<? super E> c)`
    * `sort`에 전달되는 `Comparator` 전략패턴에 따라 `sort`의 방식이 달라질 것이다.
    * `Comparator<Student>`를 구현하는 다른 인터페이스를 만들어 사용.
    * 최종 : `inventory.sort(new StudentComparator());`

### 2nd 익명 메소드 사용
* `sort()` 메소드 안에서 익명 메소드를 구현하자.
    ```java
    students.sort(new Comparator<Student>() {
        @Override
        public int compare(Student s1, Student s2) {
            // grade 타입이 int인 경우 compareTo 연산이 되지 않으므로 Integer로 캐스팅하자.
            return ((Integer) s1.getGrade()).compareTo(s2.getGrade());
        }
    });
    ```
  
### 3rd 람다식으로 변환
* **구현한 익명 메소드를 람다식으로 변경**하자.
    ```java
        // 형식 추론 X
        students.sort((Student s1, Student s2) -> ((Integer) s1.getGrade()).compareTo(s2.getGrade()));
  
        // 형식 추론을 실시하면 더 간략화 할 수 있다.
        students.sort((s1, s2) -> ((Integer) s1.getGrade()).compareTo(s2.getGrade()));
  
        // Comparator<Student>를 더 간소화할 수 없을까? -> comparing() 사용
        Comparator<Student> c1 = comparing((Student s) -> s.getGrade());
        students.sort(c1);
    ```

### 4th 메소드 참조 사용
* 구현한 람다식을 **메소드 참조**를 사용하자.
    * `Student` 클래스의 `getGrade()` 메소드를 사용하고 있다.
      ```java
      void forth() {
          // Student.getGrade() 정적메소드 참조
          Comparator<Student> c1 = comparing((Student::getGrade));
          students.sort(c1);
      }
      ```

## 요약
* **형식 추론을 이용하면 람다식의 파라미터에서 클래스를 명시적으로 사용하지 않아도 된다.**
    * 단 이는 명시적으로 사용해 가독성을 높이는 방향과 적절히 Trade-Off 를 하자.
<br></br>
* 람다식에서 파라미터 외의 변수를 사용할때는 항상 `상수(final)` 취급이 되어야 한다.
<br></br>
* **메소드 참조를 이용해서 람다식을 더욱 간략화** 할 수 있다.
    * `(ClassName var) -> var.Method() => ClassName::Method`

### 참고 자료
* 모던 자바 인 액션
* JAVA Reference
